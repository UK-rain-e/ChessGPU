var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3},Movement.prototype.update=function(e){if(void 0!==this.entity.rigidbody){var t=0,s=0,i=0;if(this.app.keyboard.isPressed(pc.KEY_M),this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(s=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(s+=this.speed),this.app.keyboard.isPressed(pc.KEY_SPACE)&&this.entity.getPosition().y<.051&&(i=50*this.speed),this.force.x=t,this.force.z=s,this.force.length()){var o=Math.cos(.25*-Math.PI),p=Math.sin(.25*-Math.PI);this.force.set(this.force.x*o-this.force.z*p,0,this.force.z*o+this.force.x*p),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}this.force.y=i,this.entity.rigidbody.applyImpulse(this.force)}};var MainCameraController=pc.createScript("mainCameraController");MainCameraController.attributes.add("moveSpeed",{type:"number",default:.003}),MainCameraController.attributes.add("enableCinematic",{type:"boolean",default:!0}),MainCameraController.prototype.getDistance=function(t,i){var e=i.x-t.x,s=i.y-t.y,n=i.z-t.z;return Math.sqrt(e*e+s*s+n*n)},MainCameraController.prototype.initialize=function(){this.mouseDown=!1,this.camera=this.entity.camera,this.target=new pc.Vec3(0,0,0),this.scrollSpeed=.5,this.phi=Math.atan(this.entity.getPosition().x/this.entity.getPosition().z),this.startTime=Date.now(),this.hypotenuse=this.getDistance(new pc.Vec3(0,0,0),new pc.Vec3(this.entity.getPosition().x,0,this.entity.getPosition().z)),this.theta=Math.atan(this.entity.getPosition().y/this.hypotenuse),this.distance=this.getDistance(this.entity.getPosition(),this.target),this.enableCinematic=!0,this.enableCinematic&&(this.enableCinematic=!1,this.cinematicFlyInit(),this.startTime=Date.now(),this.enableCinematic=!0),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)},MainCameraController.prototype.onMouseDown=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.mouseDown=!0)},MainCameraController.prototype.onMouseUp=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.mouseDown=!1)},MainCameraController.prototype.onMouseMove=function(t){if(this.mouseDown){var i=t.dx,e=t.dy;this.theta+=e*this.moveSpeed;this.theta=pc.math.clamp(this.theta,-Math.PI/2,Math.PI/2),(this.phi-=i*this.moveSpeed)>-Math.phi&&(this.theta=pc.math.clamp(this.theta,-Math.PI/2,Math.PI/2)),this.updateCameraPosition(),this.entity.lookAt(0,0,0,0,1,0)}},MainCameraController.prototype.onMouseWheel=function(t){this.distance-=t.wheel*this.scrollSpeed,this.distance=pc.math.clamp(this.distance,1,100),this.updateCameraPosition()},MainCameraController.prototype.updateCameraPosition=function(){var t=this.distance*Math.sin(this.phi)*Math.cos(this.theta),i=this.distance*Math.sin(this.theta),e=this.distance*Math.cos(this.phi)*Math.cos(this.theta);this.entity.setPosition(this.target.x+t,this.target.y+i,this.target.z+e)},MainCameraController.prototype.cinematicFlyInit=function(){this.positionCurves=new pc.CurveSet([[0,-27.025,3,-7.38,4,-3.222,5,-3.203,6,1.323,7.5,2.8,9,1.748,10,1.924,11.5,-3.905,13,-11.151,14.5,0,16.5,0,17.5,0],[0,17.943,3,2.508,4,.944,5,.834,6,1,7.5,1.319,9,.846,10,.773,11.5,2.034,13,8.743,14.5,7,16.5,9,17.5,9],[0,-4.602,3,2.615,4,2.785,5,4.909,6,5.937,7.5,2.641,9,-3.444,10,-8.944,11.5,-10.661,13,-.192,14.5,7,16.5,9,17.5,9]]),this.positionCurves.type=pc.CURVE_SPLINE,this.rotationCurves=new pc.CurveSet([[0,153.66,3,157.26,4,174.79,5,-4.81,6,-11.61,7.5,-4.2,9,-2.8,10,-2.8,11.5,0,13,-40,14.5,-45,16.5,-45,17.5,-45],[0,-86.72,3,-86.12,4,-47.11,5,-80.09,6,1.71,7.5,1.2,9,13.8,10,150,11.5,180,13,270,14.5,360,16.5,360,17.5,360],[0,-180,3,-180,4,-180,5,0,6,0,7.5,0,9,0,10,0,11.5,0,13,0,14.5,0,16.5,0,17.5,0]]),this.rotationCurves.type=pc.CURVE_SPLINE},MainCameraController.prototype.update=function(t){if(this.enableCinematic){var i=(Date.now()-this.startTime)/1e3;if(i>17.5)return this.enableCinematic=!1,this.distance=this.getDistance(this.entity.getPosition(),this.target),this.phi=Math.atan(this.entity.getPosition().x/this.entity.getPosition().z),this.hypotenuse=this.getDistance(new pc.Vec3(0,0,0),new pc.Vec3(this.entity.getPosition().x,0,this.entity.getPosition().z)),void(this.theta=Math.atan(this.entity.getPosition().y/this.hypotenuse));var e=this.positionCurves.value(i),s=this.rotationCurves.value(i);this.entity.setPosition(e[0],e[1],e[2]),this.entity.setEulerAngles(s[0],s[1],s[2])}};var MousePick=pc.createScript("mousePick");const BUTTON_OPEN_DURATION=1;MousePick.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onSelect,this),this.app.mouse.disableContextMenu(),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onSelect,this)}),this),this.currentPicked=null,this.duration=5,this.mousePicker=!0,this.chessPickCallback=t=>{},this.isNuking=!1,this.nukeOldRot=null,this.openingButtonLid=null},MousePick.prototype.setChessPickCallback=function(t){this.chessPickCallback=t},MousePick.prototype.onSelect=function(t){if(t.button===pc.MOUSEBUTTON_LEFT){var e=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.nearClip),i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),n=this.app.systems.rigidbody.raycastFirst(e,i);n?"Lid"!==n.entity.name?"BigRedButton"!==n.entity.name?"board"!==n.entity.parent.parent.name?"pieces"===n.entity.parent.name&&this.chessPickCallback(n.entity):this.chessPickCallback(n.entity):this.sendNukes(n.entity):this.openButton(n.entity):console.log("couldn't find raycast result")}},MousePick.prototype.update=function(t){if(null!==this.currentPicked){if((s=(Date.now()-this.currentPicked.curveStartTime)/1e3)>this.duration)return this.isNuking?(this.currentPicked.render.enabled=!1,this.nukeTarget.render.enabled=!1):(this.currentPicked.rigidbody.enabled=!0,this.currentPicked.collision.enabled=!0,this.isNuking=!1),void(this.currentPicked.curve=null);var e=this.currentPicked.curve.value(s);this.currentPicked.setLocalPosition(e[0],e[1],e[2]);var i=this.currentPicked.button.getLocalPosition();if(i.y=e[4],this.currentPicked.button.setLocalPosition(i),this.isNuking&&this.currentPicked.render.enabled){this.currentPicked.findByName("smoke").enabled=!0;var n=this.currentPicked.curve.value(s-.001),o=new pc.Vec3(e[0]-n[0],e[1]-n[1],e[2]-n[2]);o=o.normalize();var r=(new pc.Quat).setFromDirections(new pc.Vec3(0,0,1),o);this.currentPicked.setLocalRotation(r),e[3]>=.99&&(this.currentPicked.findByName("smoke").enabled=!1,this.currentPicked.findByName("blast").enabled=!0)}}if(null!==this.openingButtonLid){var s;if((s=(Date.now()-this.openingButtonLid.curveStartTime)/1e3)>1)return void(this.openingButtonLid=null);e=this.openingButtonLid.curve.value(s);var c=new pc.Quat(e[0],e[1],e[2],e[3]);this.openingButtonLid.setLocalRotation(c)}},MousePick.prototype.sendNukes=function(t){var e=null,i=null;"ButtonBlack"==t.parent.parent.name?(e="KB",i="KW"):(e="KW",i="KB");var n=pc.app.root.findByName(e),o=n.getLocalPosition(),r=pc.app.root.findByName(i);this.isNuking=!0,this.nukeOldRot=(new pc.Quat).copy(n.getLocalRotation());var s=r.getLocalPosition();this.currentPicked=n,this.nukeTarget=r,this.currentPicked.curve=new pc.CurveSet([[.2*this.duration,o.x,.6*this.duration,.7*o.x+.3*s.x,this.duration,s.x],[.2*this.duration,o.y,.6*this.duration,.7*o.y+.3*s.y,this.duration,s.y],[.2*this.duration,o.z,.6*this.duration,o.z+10,this.duration,o.z+1],[0,0,.1*this.duration,0,this.duration,1],[0,t.getLocalPosition().y,.05*this.duration,.55]]),this.currentPicked.curve.type=pc.CURVE_SPLINE,this.currentPicked.curveStartTime=Date.now(),this.currentPicked.button=t,n.rigidbody.enabled=!1,n.collision.enabled=!1},MousePick.prototype.openButton=function(t){if(null===this.openingButtonLid){t=t.parent,this.openingButtonLid=t;var e=t.getLocalRotation(),i=new pc.Quat;i.setFromEulerAngles(90,0,0),t.curve=new pc.CurveSet([[0,e.x,1,i.x],[0,e.y,1,i.y],[0,e.z,1,i.z],[0,e.w,1,i.w]]),t.curveStartTime=Date.now()}};var Cinematic=pc.createScript("cinematic");Cinematic.prototype.initialize=function(){},Cinematic.prototype.update=function(i){};var EntityMove=pc.createScript("entityMove");function isKnight(t){return"NB1"===t.name||"NB2"===t.name||"NW1"===t.name||"NW2"===t.name}EntityMove.prototype.initialize=function(){this.entityMove=!0,this.currentlyMoved={},this.timings=null,this.duration=null,this.jumpHeight=2,this.initSceneEntMove=!0},EntityMove.prototype.postInitialize=function(){if(this.initSceneEntMove){var t=pc.app.root.findByName("KW"),i=pc.app.root.findByName("PW5"),e=pc.app.root.findByName("KB"),n=pc.app.root.findByName("PB5");[t,e,n,i].forEach((t=>{t.rigidbody.enabled=!1,t.collision.enabled=!1})),t.setPosition(.5,t.getPosition().y,.5),i.setPosition(-.5,i.getPosition().y,.5),e.setPosition(.5,e.getPosition().y,-.5),n.setPosition(-.5,n.getPosition().y,-.5),this.setChessAnimationDuration(10),setTimeout((()=>{this.chessPieceMove(t,{x:.5,y:t.getPosition().y,z:3.5}),this.chessPieceMove(e,{x:.5,y:t.getPosition().y,z:-3.5}),this.chessPieceMove(i,{x:.5,y:t.getPosition().y,z:2.5}),this.chessPieceMove(n,{x:.5,y:t.getPosition().y,z:-2.5})}),5e3)}},EntityMove.prototype.setChessAnimationDuration=function(t){this.timings=[0,t/10,t],this.duration=t},EntityMove.prototype.moveKnightTrajectory=function(t,i){var e=t.getPosition(),n=[e,new pc.Vec3(e.x,e.y+this.jumpHeight,e.z),new pc.Vec3(e.x,e.y+this.jumpHeight,i.z),new pc.Vec3(i.x,i.y+this.jumpHeight,i.z)];return this.timings[2]=2*this.duration/3,this.timings[3]=this.duration,new pc.CurveSet([[this.timings[0],n[0].x,this.timings[1],n[1].x,this.timings[2],n[2].x,this.timings[3],n[3].x],[this.timings[0],n[0].y,this.timings[1],n[1].y,this.timings[2],n[2].y,this.timings[3],n[3].y],[this.timings[0],n[0].z,this.timings[1],n[1].z,this.timings[2],n[2].z,this.timings[3],n[3].z]])},EntityMove.prototype.movePieceLinearTrajectory=function(t,i){var e=t.getPosition(),n=new pc.Vec3((e.x+i.x)/2,i.y+this.jumpHeight,(e.z+i.z)/2),s=[e,new pc.Vec3(e.x,e.y+this.jumpHeight/2,e.z),n,new pc.Vec3(i.x,i.y+this.jumpHeight/2,i.z),new pc.Vec3(i.x,e.y,i.z)],o=2*this.jumpHeight+Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.z-i.z,2)),r=this.jumpHeight/1.4/o;this.timings=[0,this.duration*r,this.duration/2,this.duration*(1-r),this.duration];var a=new pc.CurveSet([[this.timings[0],s[0].x,this.timings[1],s[1].x,this.timings[2],s[2].x,this.timings[3],s[3].x,this.timings[4],s[4].x],[this.timings[0],s[0].y,this.timings[1],s[1].y,this.timings[2],s[2].y,this.timings[3],s[3].y,this.timings[4],s[4].y],[this.timings[0],s[0].z,this.timings[1],s[1].z,this.timings[2],s[2].z,this.timings[3],s[3].z,this.timings[4],s[4].z]]);return a.type=pc.CURVE_SPLINE,a},EntityMove.prototype.getMovePieceTrajectory=function(t,i){return this.movePieceLinearTrajectory(t,i)},EntityMove.prototype.chessPieceMove=function(t,i){if("pieces"===t.parent.name){if(null===this.duration)throw new Exception("please set move duration");if(t.name in this.currentlyMoved&&null!==this.currentlyMoved[t.name])throw new Exception("moving piece that is already being moved");this.currentlyMoved[t.name]={trajectoryCurve:this.getMovePieceTrajectory(t,i),startTime:Date.now(),entity:t},t.rigidbody.enabled=!1,t.collision.enabled=!1}},EntityMove.prototype.update=function(t){for(let t in this.currentlyMoved){var i=this.currentlyMoved[t];if(null!=i){var e=(Date.now()-i.startTime)/1e3;if(e>this.duration)i.entity.rigidbody.enabled=!0,i.entity.collision.enabled=!0,this.currentlyMoved[t]=null;else{var n=i.trajectoryCurve.value(e);i.entity.setPosition(n[0],n[1],n[2])}}}},EntityMove.prototype.setCellHighlighted=function(t,i){var e=t.render;e.material.name.endsWith(".copy")||(e.material=e.material.clone(),e.material.name=e.material.name+".copy"),i?(e.material.emissiveIntensity=.5,e.material.useLighting=!1):(e.material.emissiveIntensity=0,e.material.useLighting=!0),e.material.update()},EntityMove.prototype.setGameEnded=function(t){pc.app.root.findByName("EndScreen").enabled=!0;var i=pc.app.root.findByName("EndScreenText");t.draw?i.element.text="Game ended. Draw!":"w"==t.turn?i.element.text="Game ended.\nWhite is victorious!":i.element.text="Game ended.\nBlack is victorious!"};var MoveIndicatorColor=pc.createScript("moveIndicatorColor");MoveIndicatorColor.prototype.initialize=function(){this.textureIndex=0,this.textureIDs=[156898847,156898838]},MoveIndicatorColor.prototype.setCurrentChessPlater=function(t){this.textureIndex=t;var e=pc.app.assets.get(this.textureIDs[this.textureIndex]);this.entity.render.meshInstances.forEach((t=>t.material=e.resource))},MoveIndicatorColor.prototype.changeToNextTexture=function(t){this.setCurrentChessPlater((this.textureIndex+1)%2)};

//# sourceMappingURL=__game-scripts.js.map